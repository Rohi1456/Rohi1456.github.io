<!DOCTYPE html>
<html>
<head>
  <title>TWA Messaging Demo</title>
  <meta charset="UTF-8">
</head>
<body>
  <h1>TWA Messaging Demo</h1>
  <input type="text" id="messageInput" placeholder="Enter message">
  <button onclick="sendMessage()">Send to App</button>
  <p>Sent to App: <span id="sentMessage"></span></p>
  <p>Received from App: <span id="receivedMessage"></span></p>

  <script>
    console.log('Script loaded');

    let channel = null;

    navigator.serviceWorker.ready.then(registration => {
      if (!navigator.serviceWorker.controller) {
        console.log('No service worker controller found!');
        return;
      }

      // Listen for messages from Android
      navigator.serviceWorker.addEventListener('message', event => {
        console.log('Received message from Android:', event.data);
        document.getElementById('receivedMessage').textContent = event.data;
      });

      console.log('Sending "ACK" to Android to confirm channel');
      // Initial ping to let Android know we're ready
      navigator.serviceWorker.controller.postMessage("ACK from Web");
    });

    function sendMessage() {
      const message = document.getElementById('messageInput').value;
      if (message && navigator.serviceWorker.controller) {
        console.log('Sending message to Android:', message);
        navigator.serviceWorker.controller.postMessage(message);
        document.getElementById('sentMessage').textContent = message;
        document.getElementById('messageInput').value = '';
      } else {
        alert('Service worker not ready');
      }
    }
  </script>
</body>
</html>
